# 第四章课后作业

Section 4.3: P14, P15, P18

## 学习任务

1）理解网络层在协议栈中的位置和功能。（Sec. 4.1）
2）了解路由器的内部结构。（Sec. 4.2）
3）掌握IP地址的分配方法。（Sec. 4.3）
4）熟悉DHCP，NAT工作原理。（Sec. 4.3）

## P14. 考虑一个前缀为128.119.40.128/26的子网。举例说明一个IP地址(形式为xxx.xxx.xxx.xxx)可以分配给该网络。假设某ISP拥有128.119.40.64/26形式的地址块。假设它想从这个块创建四个子网，每个块具有相同数量的IP地址。这四个子网的前缀(形式为a.b.c.d/x)是什么?

$26 = 3 * 8 + 2$
$(10000000)_b = 128$
128.119.40.10xxxxxx(xxxxxx from 000000 to 111111)
即能被分配给该子网的IP地址范围为128.119.40.128~128.119.40.191
所以举例：128.119.40.128可以分配给该网络

$(01000000)_b = 64$
128.119.40.01xxxxxx(xxxxxx from 000000 to 111111)
即IP地址范围为128.119.40.64~128.119.40.127
可以发现同样一共有64个IP地址，分成相同数量的4份，则每个子网有16个IP地址(xxxx from 0000 to 1111)
所以a.b.c.d/x中，$x = 3 * 8 + 4 = 28, a = 128, b = 119,  c = 40, d = 64/(64+16)/(64+16+16)/(64+16+16+16) = 64/80/96/112$
所以这四个子网的前缀为128.119.40.64/28、128.119.40.80/28、128.119.40.96/28、128.119.40.112/28。

## P15. 考虑图4.20所示的拓扑。将有主机的三个子网分别命名为网络A、网络B、网络C(从12:00顺时针方向开始)。将没有主机的三个子网分别命名为网络D、网络E、网络F

a. $256 = 2^8 > 250, 128 = 2^7 > 120$
所以a.b.c.d/x中，对A来说，$x = 32 - 8 = 24$；对B、C来说，$x = 32 - 7 = 25$。
因为都从214.97.254/23开始，一共仅有512个IP地址可供分配，而$256+128+128+2+2+2>512$，所以A、B、C不能都给那么大的地址空间，这里将子网C的一部分的IP地址空出来给D、E、F(不选择A的原因是，如果一次性空出8个，则$256-8<250$，如果空出4个的话，不够，并且很麻烦)，因此分配给子网
A: 214.97.254/24(256个IP) // 214.97.254/24 ~ 214.97.254/30($256-4=252$个IP)
B: 214.97.255.0/25(128个IP) // 214.97.255.0/25 ~ 214.97.255.0/29($128-8=120$个IP)
C: 214.97.255.128/25 ~ 214.97.255.128/29($128-8=120$个IP)
D: 214.97.255.128/31(2个IP)
E: 214.97.255.130/31(2个IP)
F: 214.97.255.132/30(4个IP) // 214.97.255.132/30 ~ 214.97.255.132/31($4-2=2$个IP)

b.
R1:
前缀匹配|链路接口
11010110 01100001 11111110 | A
11010110 01100001 11111111 1000000 | D
11010110 01100001 11111111 100001 | F
R2:
前缀匹配|链路接口
11010110 01100001 11111111 100001 | F
11010110 01100001 11111111 1000001 | E
11010110 01100001 11111111 1| C
R3:
前缀匹配|链路接口
11010110 01100001 11111111 0| B
11010110 01100001 11111111 1000001 | E
11010110 01100001 11111111 1000000 | D

## P18. 考虑图4.25中的网络设置。假设ISP给路由器分配的地址为24.34.112.235，家庭网络的网络地址为192.168.1/24

a. 家庭网络中，主机接口的IP由上到下分别为192.168.1.1、192.168.1.2、192.168.1.3，路由器接口的IP为192.168.1.4

b.
NAT转换表
WAN段|LAN段
24.34.112.235, 5000 | 192.168.1.1, 3345
24.34.112.235, 5001 | 192.168.1.1, 3346
24.34.112.235, 5002 | 192.168.1.2, 3345
24.34.112.235, 5003 | 192.168.1.2, 3346
24.34.112.235, 5004 | 192.168.1.3, 3345
24.34.112.235, 5005 | 192.168.1.3, 3346
